<!-- app/templates/gpa_calculator/index.html (REPLACE FILE) -->
{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="content-grid">
        <div>
            <h2>Enter Your Grades</h2>
            <table class="gpa-table">
                <thead>
                    <tr>
                        <th>Course Name (Optional)</th>
                        <th>Credits</th>
                        <th>Grade</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="gpa-rows"></tbody>
            </table>
            <div class="gpa-actions">
                <button class="btn" onclick="addCourseRow()">+ Add Course</button>
                <button class="btn btn-primary" onclick="calculateGPA()">Calculate GPA</button>
            </div>
        </div>
        <div>
            <h2>Your Result</h2>
            <div id="gpa-result" class="gpa-result-display">
                <h3>---</h3>
            </div>
            <div id="gpa-breakdown">
                <p><strong>Total Quality Points:</strong> <span id="quality-points">0</span></p>
                <p><strong>Total Credits:</strong> <span id="total-credits">0</span></p>
            </div>
        </div>
    </div>
</div>

<script>
    // The JavaScript from the previous version remains exactly the same.
    // Copy it here.
    const gradeScale = {
        "A": 4.0, "A-": 3.7, "B+": 3.3, "B": 3.0, "B-": 2.7,
        "C+": 2.3, "C": 2.0, "C-": 1.7, "D+": 1.3, "D": 1.0, "F": 0.0
    };

    function addCourseRow() {
        const tbody = document.getElementById('gpa-rows');
        const tr = document.createElement('tr');
        let gradeOptions = '<option value="">Select</option>';
        for (const [grade, value] of Object.entries(gradeScale)) {
            gradeOptions += `<option value="${value}">${grade}</option>`;
        }
        tr.innerHTML = `
            <td><input type="text" placeholder="e.g. Intro to Python"></td>
            <td><input type="number" step="0.5" value="3.0" class="credits-input"></td>
            <td><select class="grade-select">${gradeOptions}</select></td>
            <td><button class="btn-delete" onclick="this.parentElement.parentElement.remove()">Ã—</button></td>
        `;
        tbody.appendChild(tr);
    }

    function calculateGPA() {
        const rows = document.getElementById('gpa-rows').children;
        let totalQualityPoints = 0;
        let totalCredits = 0;
        for (let row of rows) {
            const credits = parseFloat(row.querySelector('.credits-input').value);
            const gradeValue = parseFloat(row.querySelector('.grade-select').value);
            if (!isNaN(credits) && !isNaN(gradeValue) && credits > 0) {
                totalQualityPoints += credits * gradeValue;
                totalCredits += credits;
            }
        }
        const gpa = totalCredits > 0 ? (totalQualityPoints / totalCredits).toFixed(2) : "0.00";
        document.getElementById('gpa-result').querySelector('h3').textContent = gpa;
        document.getElementById('quality-points').textContent = totalQualityPoints.toFixed(2);
        document.getElementById('total-credits').textContent = totalCredits.toFixed(2);
    }

    document.addEventListener('DOMContentLoaded', () => {
        addCourseRow();
        addCourseRow();
        addCourseRow();
    });
</script>
{% endblock %}